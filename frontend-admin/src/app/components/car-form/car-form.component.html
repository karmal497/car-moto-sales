<div class="form-container">
  <h1>{{isEdit ? 'Editar Auto' : 'Nuevo Auto'}}</h1>

  <mat-card class="form-card">
    <mat-card-content>
      <form [formGroup]="carForm" (ngSubmit)="onSubmit()" class="car-form" enctype="multipart/form-data">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Título</mat-label>
            <input matInput formControlName="title" required>
            <mat-icon matSuffix>title</mat-icon>
            <mat-error *ngIf="carForm.get('title')?.hasError('required')">
              El título es requerido
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Precio</mat-label>
            <input matInput type="number" formControlName="price" required>
            <span matPrefix>$&nbsp;</span>
            <mat-error *ngIf="carForm.get('price')?.hasError('required')">
              El precio es requerido
            </mat-error>
            <mat-error *ngIf="carForm.get('price')?.hasError('min')">
              El precio debe ser mayor a 0
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Marca</mat-label>
            <input matInput formControlName="brand" required>
            <mat-icon matSuffix>branding_watermark</mat-icon>
            <mat-error *ngIf="carForm.get('brand')?.hasError('required')">
              La marca es requerida
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Modelo</mat-label>
            <input matInput formControlName="model" required>
            <mat-icon matSuffix>model_training</mat-icon>
            <mat-error *ngIf="carForm.get('model')?.hasError('required')">
              El modelo es requerido
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Año</mat-label>
            <input matInput type="number" formControlName="year" required>
            <mat-icon matSuffix>calendar_today</mat-icon>
            <mat-error *ngIf="carForm.get('year')?.hasError('required')">
              El año es requerido
            </mat-error>
            <mat-error *ngIf="carForm.get('year')?.hasError('min') || carForm.get('year')?.hasError('max')">
              El año debe estar entre 1900 y {{maxYear}}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Color</mat-label>
            <input matInput formControlName="color" required>
            <mat-icon matSuffix>color_lens</mat-icon>
            <mat-error *ngIf="carForm.get('color')?.hasError('required')">
              El color es requerido
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Motor</mat-label>
            <input matInput formControlName="engine" required>
            <mat-icon matSuffix>engineering</mat-icon>
            <mat-error *ngIf="carForm.get('engine')?.hasError('required')">
              El motor es requerido
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Transmisión</mat-label>
            <mat-select formControlName="transmission" required>
              <mat-option *ngFor="let option of transmissionOptions" [value]="option.value">
                {{option.label}}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>settings</mat-icon>
            <mat-error *ngIf="carForm.get('transmission')?.hasError('required')">
              La transmisión es requerida
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Kilometraje</mat-label>
            <input matInput type="number" formControlName="mileage" required>
            <span matPrefix>km&nbsp;</span>
            <mat-error *ngIf="carForm.get('mileage')?.hasError('required')">
              El kilometraje es requerido
            </mat-error>
            <mat-error *ngIf="carForm.get('mileage')?.hasError('min')">
              El kilometraje debe ser mayor a 0
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Tipo de Combustible</mat-label>
            <input matInput formControlName="fuel_type" required>
            <mat-icon matSuffix>local_gas_station</mat-icon>
            <mat-error *ngIf="carForm.get('fuel_type')?.hasError('required')">
              El tipo de combustible es requerido
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width form-field">
          <mat-label>Descripción</mat-label>
          <textarea matInput formControlName="description" rows="4" required></textarea>
          <mat-icon matSuffix>description</mat-icon>
          <mat-error *ngIf="carForm.get('description')?.hasError('required')">
            La descripción es requerida
          </mat-error>
        </mat-form-field>

        <div class="form-row">
          <div class="file-upload full-width">
            <label for="image" class="upload-label">
              <mat-icon>cloud_upload</mat-icon>
              <span>{{carForm.get('image')?.value?.name || 'Seleccionar imagen del auto'}}</span>
            </label>
            <input type="file" id="image" (change)="onImageSelected($event)" accept="image/*" hidden>
            <div class="upload-hint">Formatos: JPG, PNG, GIF. Tamaño máximo: 5MB</div>
          </div>
        </div>

        <div class="form-row">
          <mat-checkbox formControlName="is_sold" color="primary" class="sold-checkbox">
            ¿Vendido?
          </mat-checkbox>
        </div>

        <div class="form-actions">
          <button type="button" mat-button routerLink="/cars" class="cancel-btn">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          <button type="submit" mat-raised-button color="primary" [disabled]="!carForm.valid || isLoading" class="submit-btn">
            <mat-icon>{{isEdit ? 'update' : 'add_circle'}}</mat-icon>
            {{isLoading ? 'Guardando...' : (isEdit ? 'Actualizar' : 'Crear')}}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
